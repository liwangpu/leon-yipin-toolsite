
@{
    ViewBag.Title = "配货绩效";
    Layout = "~/Views/Shared/_MetadataUpload.cshtml";
}

@section scripts{
    <script>
        require(["dojo/ready", "dijit/registry", "dojo/request/iframe", "dojo/on", "dojo/dom", "dojo/topic"], function (ready, registry, iframe, on, dom, topic) {
            ready(function () {
                on(dom.byId("nav"), "click", function () { location.href = "/"; });
                registry.byId("btnWorkHoursUpload").on("click", uploadWorkHoursMetadata);
                registry.byId("btnProcesingPerfData").on("click", uploadDailyPerfMetadata);
                registry.byId("workHourMonth").set("value", new Date().getMonth() + 1);//初始化月工作时间的月份信息
                registry.byId("pickingDate").set("value", new Date());//初始化月工作时间的月份信息
            });//ready

            function uploadWorkHoursMetadata() {
                var wform = registry.byId("monthlyWorkingHoursForm");
                if (!wform.validate()) return;

                topic.publish("DataProcessing");
                iframe("/Salaries/MonthlyWorkingHoursHandle", {
                    form: "monthlyWorkingHoursForm"
                }).then(function () {
                    topic.publish("DataProcessCompleted");
                    topic.publish("TipOperateSuccessfully");
                }, function (err) {
                    topic.publish("DataProcessCompleted");
                    topic.publish("ReportErrorMessage", err);
                });
            }//uploadWorkHoursMetadata


            function uploadDailyPerfMetadata() {
                var wform = registry.byId("dailyPerfForm");
                if (!wform.validate()) return;

                topic.publish("DataProcessing");
                iframe("/Salaries/DailyWorkingHoursHandler", {
                    form: "dailyPerfForm"
                }).then(function (path) {
                    topic.publish("DownloadProcessExel", path);
                    topic.publish("DataProcessCompleted");
                }, function (err) {
                    topic.publish("DataProcessCompleted");
                    topic.publish("ReportErrorMessage", err);
                });
            }//uploadDailyPerfMetadata

            function downloadDailyPerfTable() {
                var wform = registry.byId("perfDownloadForm");
                if (!wform.validate()) return;



            }//downloadDailyPerfTable
        });//require
    </script>
}


@section uploadbox{
    <form method="post" enctype="multipart/form-data" data-dojo-type="dijit/form/Form" id="monthlyWorkingHoursForm">
        <p class="form-title">月上班时间信息</p>
        <div class="form-item required">
            <label>月份</label>
            <input type="number" data-dojo-type="dijit/form/NumberSpinner" data-dojo-props="constraints:{min:1,max:12}" name="month" id="workHourMonth" required />
        </div>
        <div class="form-item required">
            <label for="orderRecord">上班时间</label>
            <div data-dojo-type="mytool/singleUploader" data-dojo-props="name:'monthlyWorkingHoursFile',accept:'.xlsx',required:true"></div>
        </div>
        <button data-dojo-type="dijit/form/Button" id="btnWorkHoursUpload">数据上传</button>
        <p class="form-tip">该数据每个月上传一次就好了不用每天都上传，不过如果不确定是否上传过或者数据有改动，再来一次也可以</p>
    </form>
}

@section custom{
    <div class="upload-box">
        <form method="post" enctype="multipart/form-data" data-dojo-type="dijit/form/Form" id="dailyPerfForm">
            <p class="form-title">当天绩效计算</p>
            <div class="form-group">
                <div class="form-item required">
                    <label>绩效日期</label>
                    <input type="text" data-dojo-type="dijit/form/DateTextBox" name="pickingDate" id="pickingDate" required />
                </div>
                <div class="form-item required">
                    <label>拣货单</label>
                    <div data-dojo-type="mytool/singleUploader" data-dojo-props="name:'pickingFile',accept:'.xlsx',required:true"></div>
                </div>
                <div class="form-item required">
                    <label>大单</label>
                    <div data-dojo-type="mytool/singleUploader" data-dojo-props="name:'randomFile',accept:'.xlsx',required:true"></div>
                </div>
                <div class="form-item required">
                    <label>配货人员</label>
                    <div data-dojo-type="mytool/singleUploader" data-dojo-props="name:'areaRepFile',accept:'.xlsx',required:true"></div>
                </div>
                <div class="form-item">
                    <label for="orderRecord">帮忙时间</label>
                    <div data-dojo-type="mytool/singleUploader" data-dojo-props="name:'helpingHoursFile',accept:'.xlsx'"></div>
                </div>
            </div>
            <div class="form-group">
                <div class="form-item required">
                    <label>张数定值</label>
                    <input type="number" data-dojo-type="dijit/form/NumberTextBox" name="paperAmount" id="paperAmount" value="208" required />
                </div>
                <div class="form-item required">
                    <label>张数占比</label>
                    <input type="number" data-dojo-type="dijit/form/NumberTextBox" name="paperRate" id="paperRate" value="0.75" required />
                </div>
                <div class="form-item required">
                    <label>数量定值</label>
                    <input type="number" data-dojo-type="dijit/form/NumberTextBox" name="pickingAmount" id="pickingAmount" value="1186" required />
                </div>
                <div class="form-item required">
                    <label>数量占比</label>
                    <input type="number" data-dojo-type="dijit/form/NumberTextBox" name="pickingRate" id="pickingRate" value="0.25" required />
                </div>
                <button data-dojo-type="dijit/form/Button" id="btnProcesingPerfData">绩效计算</button>
            </div>
            <p class="form-tip">帮忙时间如果当天没有可以不用上传</p>
            <p class="form-tip">如果某天绩效忘记算了或者数据有改动，可以直接把数据上传再算一次</p>
            <p class="form-tip">如果想查看一下某个月份所有算过的绩效信息，可以在下面的“历史绩效下载”里面，随便选择这个月份的某个日期，然后点击“我想看看和上面这个指定“绩效日期”月份相关的所有历史绩效信息”这句话，就可以看到啦</p>
        </form>
    </div>

    <div class="upload-box">
        <form data-dojo-type="dijit/form/Form" id="perfDownloadForm">
            <p class="form-title">历史绩效下载</p>
            <div class="form-item required">
                <label>绩效日期</label>
                <input type="text" data-dojo-type="dijit/form/DateTextBox" name="dowloadPickingDate" id="dowloadPickingDate" required />
            </div>

            <button data-dojo-type="dijit/form/Button" id="btnDownloadDailyPerfData">下载当天绩效</button>
            <button data-dojo-type="dijit/form/Button" id="btnDownloadMonthlyPerfData">下载全月绩效</button>
            <a class="tip-link" href="#">我想看看和上面这个指定“绩效日期”月份相关的所有历史绩效信息</a>
        </form>
    </div>
}
